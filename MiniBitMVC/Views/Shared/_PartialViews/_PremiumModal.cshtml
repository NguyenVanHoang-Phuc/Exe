@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@{
    // Lấy anti-forgery token để gửi kèm AJAX
    var token = Antiforgery.GetAndStoreTokens(Context).RequestToken;
}

<link href="~/css/Auth.css" rel="stylesheet" />

<div class="modal fade" id="premiumModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title text-primary fw-bold">
                    <i class="fas fa-crown text-warning me-2"></i> Nâng cấp Premium
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-4">
                    <div class="col-md-6">
                        <img src="~/images/Premium_banner.png" alt="Premium" class="img-fluid rounded shadow-sm">
                    </div>
                    <div class="col-md-6">
                        <h4 class="mb-3">Tính năng nổi bật của Premium</h4>
                        <ul class="list-unstyled mb-4">
                            <li class="mb-2">
                                <i class="fas fa-robot text-success me-2"></i>
                                AI cố vấn chi tiêu thông minh
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-chart-pie text-info me-2"></i>
                                Bảng tóm tắt cá nhân / tháng
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-bell text-danger me-2"></i>
                                Cảnh báo ngân sách thông minh
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-star text-warning me-2"></i>
                                Ưu tiên cập nhật tính năng mới
                            </li>
                        </ul>
                        <div class="alert alert-info small">
                            Chỉ <strong>29.000đ/tháng</strong> – hủy bất cứ lúc nào
                        </div>
                        <form action="@Url.Action("Checkout", "Checkout")" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="planId" value="premium-monthly" />
                            <input type="hidden" name="couponCode" value="null" />
                            <button type="submit" class="btn btn-premium btn-lg w-100" id="buyPremiumBtn">
                                <i class="fas fa-credit-card me-2"></i>Mua ngay
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    (() => {
        const buyBtn = document.getElementById('buyPremiumBtn');
        const modalEl = document.getElementById('premiumModal');
        const navbarBtn = document.querySelector('[data-bs-target="#premiumModal"]');
        const premiumText = document.getElementById('premiumText');

        // Khi trang load, kiểm tra trạng thái Premium
        fetch('@Url.Action("Status", "Premium")', { credentials: 'same-origin' })
            .then(r => r.ok ? r.json() : { isPremium: false })
            .then(d => {
                if (d?.isPremium) {
                    afterPremiumUI();
                }
            }).catch(() => {});

        function afterPremiumUI() {
            if (premiumText) premiumText.textContent = 'Premium';
            if (navbarBtn) {
                navbarBtn.classList.remove('btn-warning');
                navbarBtn.classList.add('btn-outline-secondary');
                navbarBtn.removeAttribute('data-bs-toggle');
                navbarBtn.removeAttribute('data-bs-target');
            }
        }

        // Hàm hiển thị thông báo Toast
        function showToast(message, isError) {
            const el = document.createElement('div');
            el.className = 'position-fixed top-0 start-50 translate-middle-x mt-3 alert ' + (isError ? 'alert-danger' : 'alert-success');
            el.style.zIndex = 1080;
            el.textContent = message;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 2000);
        }
    })();
</script>

